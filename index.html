<!DOCTYPE html>
<html lang="en-US">
    <head>
        <!-- Page title -->
        <title>A League Of Legends Homepage - LoLFocus</title>
        
        <!-- Meta -->
        <meta charset="UTF-8">
        <meta name="author" content="IcEaGe">
        <meta name="description" content="A homepage replacement for people who play League Of Legends">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        
		<!-- Favicon -->
		<link rel="shortcut icon" href="favicon.ico" />
		
        <!-- Style -->
        <link rel="stylesheet/less" type="text/css" href="assets/css/main.less" />
        <!--<link rel="stylesheet" type="text/css" href="assets/css/main.css" />-->
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,400,600,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://malihu.github.io/custom-scrollbar/jquery.mCustomScrollbar.min.css" />
        <link rel="stylesheet" href="assets/icons/style.css" />

        <!-- Script -->
        <script src="assets/js/jquery-2.1.1.min.js"></script>
        <script src="assets/js/less-1.7.0.min.js"></script>
        <script src="assets/js/jquery.cookie.js"></script>
        <script src="http://malihu.github.io/custom-scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
        <script src="assets/js/Ice/ice.js"></script>
        <script src="assets/js/Ice/ui/ice.ui.background.js"></script>
        <script src="assets/js/Ice/ui/ice.ui.bookmarks.js"></script>
        <script src="assets/js/Ice/ui/ice.ui.modal.js"></script>
        <script src="assets/js/Ice/ui/ice.ui.newsfeed.js"></script>
        <script src="assets/js/Ice/ui/ice.ui.settings.js"></script>
        <script src="assets/js/Ice/ui/ice.ui.sidebar.js"></script>
        <script src="assets/js/Ice/ui/constants.js"></script>
        <script src="assets/js/Ice/ice.util.js"></script>
		
    </head>
    <body>
        
        <!-- Background -->
        <div id="background"></div>
        
        <!-- Layout -->
        <div class="layout">
            <div class="menu">
                <a id="settings-button" class="button" style="float: right">Settings</a>
                <a id="background-button" class="button" style="float: right">Select background</a>
            </div>
            
            <!-- Logo -->
            <div class="logo"><img src='assets/images/lolflogo.png' alt=""/></div>
            
            <!-- Search -->
            <div class="search">
                <div class="title">Search</div>
                
                <input id="searchbox" type="text" placeholder="Search..." />
                <div class='suggestions'></div>
            </div>
            
            <div class="two-column">
                <div id='bookmarks' class="one big-modal">
                    <div class="title">Bookmarks</div>
                    <div class='bookmark-add'>+</div>
                    <div class='content'>
                        <div class='container'>
                            <div class="loading-circle" id="bookmark-loading"></div>
                        </div>
                    </div>
                </div>
                <div id='newsfeed' class="two big-modal">
                    <div class="title">News feed</div>
                    <div class='content'>
                        <div class='container'>
                            <div class="loading-circle" id="newsfeed-loading"></div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    
        <!-- Sidebar -->
        <a id="sidebar-button" class="button" style="float: left"><i class="icon-menu2"></i></a>
        <div class="sidebar">
            <div class="spacer">Useful sites</div>
            <ul id='sidebar-normal'>
            </ul>
            <div class="spacer">My profiles</div>
            <ul id="sidebar-profile">
                <center>Go to settings and specify summoner name and region to access this feature</center>
            </ul>
        </div>
        
        <!-- Modal -->
        <div class="dimmer"></div>
        <div id="modal" class="big-modal popup-modal">
            <div class="close">&#215;</div>
            <div class="title"></div>
            <div class="content">
                <div class="container"></div>
            </div>
        </div>
    
        <script>
        $(document).ready(function() {
            //Search functionality
            $("#searchbox").keyup(function(e) {
                var code = (e.keyCode ? e.keyCode : e.which);
                if(code == 13) {
                    window.location = "http://google.com/search?q=" + encodeURIComponent($("#searchbox").val());
                }
            });

            //Update data from cookie
            Ice.fn.data.updateFromData();
            console.log(Ice.data);

            //set background
            Ice.ui.background.set();

            //set bookmarks
            $('#bookmark-loading').remove();
            $("#bookmarks .content .container").append('<ul id="bookmark-list"></ul>');
            function updateBookmarks() {
                $("#bookmarks .content .container").html('');
                $("#bookmarks .content .container").append('<ul id="bookmark-list"></ul>');
                if(typeof Ice.data.bookmarks != 'undefined' && Ice.data.bookmarks.length != 0) {
                    $("#bookmark-list").html('');
                    $.each(Ice.data.bookmarks, function(i, e) {
                        $("#bookmark-list").append("<li><a href=\""+e.url+"\">"+e.title+"</a><span class='bookmark-remove button' data-id='"+i+"'>x</span></li>");
                    });
                } else {
                    $("#bookmarks .content .container").append('<center>No bookmarks.<br>You can add bookmarks trough the <b>+</b> button</center>');
                }
            }
            updateBookmarks();
            //open bookmark add modal
            $('.bookmark-add').click(function() {
                Ice.ui.modal.set('Add bookmark', "Link: <input type='text' id='bookmark-add-link' placeholder='http://www.example.com/' /> *do not forget http:// or https://<br/>\
                                Name: <input type='text' id='bookmark-add-name' placeholder='Example' /> *This will be displayed on the list<br/>\
                                <input type='button' id='bookmark-add-button' value='Add' />");
                Ice.ui.modal.show();
                $('#bookmark-add-button').click(function() {
                    Ice.fn.addBookmark($('#bookmark-add-name').val(), $('#bookmark-add-link').val());
                    updateBookmarks();
                    Ice.ui.modal.hide();
                });
                return false;
            });
            //remove bookmark
            $('.bookmark-remove').click(function() {
                Ice.fn.removeBookmark($(this).data('id'));
                updateBookmarks();
                return false;
            });

            //Set news feed
            $.get((typeof Ice.data.newsfeed != 'undefined' ? Ice.data.newsfeed : Ice.settings.defaultNewsFeed), function (data) {
                $('#newsfeed-loading').remove();
                $("#newsfeed .content .container").append('<ul id="newsfeed-list"></ul>');
                $(data).find("item").each(function () { // or "item" or whatever suits your feed
                    var el = $(this);
                    $("#newsfeed-list").append("<a href=\""+el.find("link").text()+"\"><li>"+el.find("title").text()+"</li></a>");
                });
                $('#newsfeed .content .container ul').mCustomScrollbar({
                    theme: "minimal-dark"
                });
            });

            function updateSidebar() {
                var sidebarnormal = '';
                for(var i=0;i<Ice.ui.sidebar.pages.normal.length; i++) {
                    sidebarnormal += '<a href="'+Ice.ui.sidebar.pages.normal[i].link+'"><li><img src="'+Ice.ui.sidebar.pages.normal[i].favicon+'" />'+Ice.ui.sidebar.pages.normal[i].name+'</li></a>';
                }
                $('#sidebar-normal').html(sidebarnormal);

                if(typeof Ice.data.summonerName != 'undefined' && typeof Ice.data.region != 'undefined') {
                    var sidebarprofile = '';
                    for(var i=0;i<Ice.ui.sidebar.pages.profile.length; i++) {
                        var test = new Ice.fn.stringBuilder(Ice.ui.sidebar.pages.profile[i].link);
                        test.bindParam(':region', Ice.data.region);
                        test.bindParam(':name', Ice.data.summonerName);
                        sidebarprofile += '<a href="'+test.get()+'"><li><img src="'+Ice.ui.sidebar.pages.profile[i].favicon+'" />'+Ice.ui.sidebar.pages.profile[i].name+'</li></a>';
                    }
                    $('#sidebar-profile').html(sidebarprofile);
                }
            }

            if(Ice.data.sidebarOpen) {
                updateSidebar();
                $('.sidebar').css('display', 'block');
                Ice.ui.sidebar.reposition();
            }

            //Sidebar button
            $('#sidebar-button').click(function() {
                updateSidebar();
                Ice.ui.sidebar.toggle();
            });

            //Settings button
            $("#settings-button").click(function() {
                Ice.ui.modal.set('Settings', "<div class='head'>General:</div>\
                    <input type='checkbox' data-option='animations' "+((typeof Ice.data.animations != 'undefined' && Ice.data.animations == true) ? "checked='checked'" : "")+">Enable animations</input>\
                    <div class='head'>League Information</div>\
                    <b>Summoner name:</b>\
                    <input type='text' id='settings-summonername' placeholder='Summoner name' "+(typeof Ice.data.summonerName != 'undefined' ? "value='"+Ice.data.summonerName+"'" : "")+"/>\
                    <select id='settings-summonerregion'>\
                        <option value='' disabled selected>Region</option>\
                        <option value='na'>NA</option>\
                        <option value='euw'>EUW</option>\
                        <option value='eune'>EUNE</option>\
                        <option value='oce'>OCE</option>\
                    </select>\
                    <input id='settings-summonersubmit' type='button' value='Submit' />");
                Ice.ui.modal.show();
                Ice.ui.settings.initHandlers();
                return false;
            });

            //Background button
            $("#background-button").click(function() {
                Ice.ui.modal.set('Change background', Ice.ui.background.popup);
                Ice.ui.modal.show();
                Ice.ui.background.updateBackgroundList();
                $('input:radio[name="backgroundtype"]').change(function() {
                    Ice.ui.background.updateBackgroundList();
                });
                return false;
            });

            $(window).resize(function() {
                //Correct sidebar
                Ice.ui.sidebar.reposition();
            });

            //scroll
            $('.sidebar').mCustomScrollbar({
                theme: "minimal"
            });
            $('#modal .content').mCustomScrollbar({
                theme: "inset-dark",
                scrollButtons: {enable: true},
                mouseWheel: {deltaFactor: 8}
            });
            $('#bookmarks .content .container ul').mCustomScrollbar({
                theme: "minimal-dark"
            });

            //search
            function updateSearchSuggestions(query) {
                if($('.suggestions .container').length == 0) {$('.suggestions').append('<div class="container"></div>')};
                if($('.suggestions .container #search-url').length == 0) {
                    if(ValidURL(query)) {
                        $('.suggestions .container').append('<a href="'+query+'"><div id="search-url" class="element"><div class="type">Open site <b>'+query+'</b>\</div></a>');
                    }
                } else {
                    if(ValidURL(query)) {
                        $('.suggestions .container').html('<a href="'+query+'"><div id="search-url" class="element"><div class="type">Open site <b>'+query+'</b>\</div></a>');
                    }
                }
                if($('.suggestions .container #search-web').length == 0) {
                    $('.suggestions .container').append('<div id="search-web" class="element"><div class="type">Search on the web for <b>'+query+'</b>\
                    <div class="sites">\
                        <a href="http://google.com/search?q='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/google.png"> Google</a>\
                        <a href="http://search.yahoo.com/search?q='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/yahoo.png"> Yahoo!</a>\
                        <a href="http://www.bing.com/search?q='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/bing.png"> Bing</a>\
                    </div></div>');
                } else {
                    $('.suggestions .container #search-web').html('<div class="type">Search on the web for <b>'+query+'</b>\
                    <div class="sites">\
                        <a href="http://google.com/search?q='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/google.png"> Google</a>\
                        <a href="http://search.yahoo.com/search?q='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/yahoo.png"> Yahoo!</a>\
                        <a href="http://www.bing.com/search?q='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/bing.png"> Bing</a>\
                    </div>');
                }
                if($('.suggestions .container #search-summoner').length == 0) {
                    $('.suggestions .container').append('<div id="search-summoner" class="element"><div class="type">Search for summoner: <b>'+query+'</b>\
                    <div class="sites">\
                        <a href="http://www.lolking.net/search?name='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/lolking.png" /> LoLKing</a>\
                    </div></div>');
                } else {
                    $('.suggestions .container #search-summoner').html('<div class="type">Search for summoner: <b>'+query+'</b>\
                    <div class="sites">\
                        <a href="http://www.lolking.net/search?name='+encodeURIComponent(query)+'" class="site button"><img class="favicon" src="assets/images/favicons/lolking.png" /> LoLKing</a>\
                    </div>');
                }

            }
            function ValidURL(str) {
                var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
                return regexp.test(str);
            }

            $('#searchbox').focusin(function() {
                var needtoclose = true;
                $('.suggestions').html('');
                if($(this).val() != "") {
                    $('.two-column').hide();
                    $('.suggestions').show();

                    updateSearchSuggestions($(this).val());
                    needtoclose = false;
                }
                $(this).bind('input', function(e) {
                    if(needtoclose) {$('.two-column').fadeOut();$('.suggestions').slideDown();}

                    updateSearchSuggestions($(this).val());
                    if($(this).val() == "") {$('.suggestions').html(''); $('.two-column').fadeIn();needtoclose=true;}
                });

                $('.suggestions .container').mCustomScrollbar();
            });
            $('#searchbox').focusout(function() {
                setTimeout(function() {
                    $('.two-column').fadeIn();

                    $('.suggestions').slideUp();
                    $('.suggestions').html('');
                    $(this).unbind('input');
                },200);
            });
        });
        </script>
    </body>
</html>